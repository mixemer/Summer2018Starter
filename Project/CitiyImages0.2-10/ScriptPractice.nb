(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='WolframDesktop 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       161,          7]
NotebookDataLength[     15550,        353]
NotebookOptionsPosition[     13769,        320]
NotebookOutlinePosition[     14121,        336]
CellTagsIndexPosition[     14078,        333]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"Print", "[", "\"\<Starting Script.\>\"", "]"}]], "Input",
 CellChangeTimes->{{3.7400826815775633`*^9, 
  3.7400826901092978`*^9}},ExpressionUUID->"5d132b6a-5bb9-44c4-b6c4-\
b487a14f0d7d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"encodeID", "[", "expr_", "]"}], ":=", 
  RowBox[{"StringReplace", "[", 
   RowBox[{
    RowBox[{"Developer`EncodeBase64", "@", 
     RowBox[{"BinarySerialize", "@", "expr"}]}], ",", 
    RowBox[{"\"\</\>\"", "\[Rule]", "\"\<~\>\""}]}], "]"}]}], "\n", 
 RowBox[{
  RowBox[{"decodeID", "[", "expr_", "]"}], ":=", 
  RowBox[{"BinaryDeserialize", "@", 
   RowBox[{"Developer`DecodeBase64ToByteArray", "@", 
    RowBox[{"StringReplace", "[", 
     RowBox[{"expr", ",", 
      RowBox[{"\"\<~\>\"", "\[Rule]", "\"\</\>\""}]}], "]"}]}]}]}]}], "Code",
 CellChangeTimes->{{3.739789762021864*^9, 3.739789762559952*^9}, {
   3.739800684455359*^9, 3.739800686765916*^9}, {3.739800815156169*^9, 
   3.7398008533828907`*^9}, {3.7398013078785*^9, 3.739801350512285*^9}, {
   3.73980166287597*^9, 3.7398016698627768`*^9}, {3.739801774293898*^9, 
   3.739801791482527*^9}, {3.7398019189468527`*^9, 3.739801925170198*^9}, {
   3.739802061676139*^9, 3.739802062209395*^9}, {3.739802098299829*^9, 
   3.739802098563325*^9}, {3.739802220876359*^9, 3.739802243732388*^9}, {
   3.739802698377903*^9, 3.739802711713552*^9}, {3.739802878821467*^9, 
   3.7398028851268673`*^9}, 3.73980371509159*^9, {3.7398043745892963`*^9, 
   3.739804385698215*^9}, {3.739804859249752*^9, 3.73980486069774*^9}, {
   3.7398079655119658`*^9, 3.739807974030197*^9}, {3.7398768157604733`*^9, 
   3.7398768167748213`*^9}, {3.7398768679552803`*^9, 3.739876868133729*^9}, {
   3.7398902242482643`*^9, 3.739890251585997*^9}, {3.739890735233392*^9, 
   3.739890739117865*^9}, {3.739890770924474*^9, 3.739890771560625*^9}},
 CellLabel->"In[8]:=",ExpressionUUID->"9fb56a29-a30f-47ed-b0be-1e5588ff999d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"getFileNames", ",", "fromFileNameGetGeoRange"}], "]"}], 
  "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"getFileNames", "[", "folderName_", "]"}], " ", ":=", " ", 
    "\[IndentingNewLine]", "\t", 
    RowBox[{"FileNames", "[", 
     RowBox[{"\"\<*.png\>\"", ",", 
      RowBox[{"FileNameJoin", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"NotebookDirectory", "[", "]"}], ",", "folderName"}], "}"}], 
       "]"}], ",", "Infinity"}], "]"}]}], ";"}], "\n"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"fromFileNameGetGeoRange", "[", "fileName_", "]"}], " ", ":=", " ",
    "\[IndentingNewLine]", "\t", 
   RowBox[{
    RowBox[{"decodeID", "[", 
     RowBox[{"FileBaseName", "@", "fileName"}], "]"}], "[", 
    "\"\<GeoRange\>\"", "]"}]}], ";"}]}], "Code",
 CellChangeTimes->{{3.739798994810848*^9, 3.739799106373658*^9}, {
   3.73979918696869*^9, 3.739799189173995*^9}, {3.739800536559061*^9, 
   3.7398005456289577`*^9}, {3.7398007537355633`*^9, 3.739800755007427*^9}, {
   3.73980798084542*^9, 3.739807984301815*^9}, {3.739816239558016*^9, 
   3.739816259591639*^9}, {3.739876747503406*^9, 3.739876750115047*^9}, {
   3.73987678716219*^9, 3.739876788435754*^9}, {3.739876819414094*^9, 
   3.7398768201087646`*^9}, 3.739876870272602*^9, {3.739889645573697*^9, 
   3.739889662490424*^9}, 3.7398901011512337`*^9, 3.739890586585747*^9, {
   3.739890773102229*^9, 3.739890783123618*^9}, {3.739933799957367*^9, 
   3.739933811314148*^9}, {3.7399341009992733`*^9, 3.73993410403885*^9}, 
   3.740078740478179*^9, {3.740078817765798*^9, 3.740078820224347*^9}, 
   3.740078913716082*^9, {3.740079004124722*^9, 3.74007900622825*^9}, {
   3.740103336167499*^9, 3.740103341444057*^9}, 3.7401037523009863`*^9, {
   3.740103907206933*^9, 3.740103927993205*^9}, {3.740144832801948*^9, 
   3.740144863816265*^9}},ExpressionUUID->"481ed2c4-9e6c-491a-88f0-\
01bd59d05586"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "associateFilesToGeoRange", "]"}], "\n", 
 RowBox[{
  RowBox[{"associateFilesToGeoRange", "[", "fileNames_", "]"}], " ", ":=", 
  " ", "\[IndentingNewLine]", "\t", 
  RowBox[{"Map", "[", "\n", "\t\t", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{"File", "[", "#", "]"}], " ", "\[Rule]", " ", 
      RowBox[{"fromFileNameGetGeoRange", "[", "#", "]"}]}], " ", "&"}], ",", 
    "\n", "\t\t", 
    RowBox[{"getFileNames", "[", "fileNames", "]"}]}], "\n", "\t", 
   "]"}]}]}], "Code",
 CellChangeTimes->{{3.7397993510600557`*^9, 3.739799441510771*^9}, {
  3.7398037014281597`*^9, 3.7398037017644997`*^9}, {3.739803736350881*^9, 
  3.739803775624164*^9}, {3.7398038904113197`*^9, 3.739803935244315*^9}, {
  3.7398079869401827`*^9, 3.739807990212175*^9}, {3.7398902993825293`*^9, 
  3.7398903032155533`*^9}, {3.7398904793630953`*^9, 3.739890528775085*^9}, {
  3.739890799617256*^9, 3.7398908128937197`*^9}, {3.739908918160569*^9, 
  3.7399089186164618`*^9}, {3.740079463854998*^9, 3.740079466135654*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"0e200563-c4d3-40f0-bb21-e86b49df1682"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"FileNames", "[", "\"\<training\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"%", "//", "Length"}]}], "Input",
 CellChangeTimes->{{3.7401070971324453`*^9, 3.7401071070201387`*^9}},
 CellLabel->
  "In[187]:=",ExpressionUUID->"cf962838-5d57-4100-b48f-e1a5d0d45842"],

Cell[BoxData["0"], "Output",
 CellChangeTimes->{3.7401071073838167`*^9},
 CellLabel->
  "Out[188]=",ExpressionUUID->"57f399fd-f021-4607-b9cb-474bdfb7a679"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", 
  RowBox[{"training", ",", "validation", ",", "testing"}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", "\"\<get data.\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"training", " ", "=", " ", 
   RowBox[{"associateFilesToGeoRange", "[", "\"\<training\>\"", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"validation", " ", "=", " ", 
   RowBox[{"associateFilesToGeoRange", "[", "\"\<validation\>\"", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"testing", " ", "=", " ", 
   RowBox[{"associateFilesToGeoRange", "[", "\"\<testing\>\"", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.740017377381795*^9, 3.740017386165236*^9}, {
  3.740066866680401*^9, 3.740066875262417*^9}, {3.7400795873349857`*^9, 
  3.740079622620247*^9}, {3.740080173368104*^9, 3.7400801797803907`*^9}, {
  3.7400805154925747`*^9, 3.740080525301515*^9}, {3.7401035127529163`*^9, 
  3.740103515964169*^9}},ExpressionUUID->"a876e179-bd04-46e2-b385-\
46ba621547ee"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{"trainSmall", ",", "validationSmall", ",", "testSmall"}], "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"trainSmall", " ", "=", " ", 
   RowBox[{"RandomSample", "[", 
    RowBox[{"TakeSmallestBy", "[", 
     RowBox[{"training", ",", "Last", ",", 
      RowBox[{"UpTo", "[", "11854", "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"validationSmall", " ", "=", " ", 
   RowBox[{"RandomSample", "[", 
    RowBox[{"TakeSmallestBy", "[", 
     RowBox[{"validation", ",", "Last", ",", 
      RowBox[{"UpTo", "[", "1975", "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"testSmall", " ", "=", " ", 
   RowBox[{"RandomSample", "[", 
    RowBox[{"TakeSmallestBy", "[", 
     RowBox[{"testing", ",", "Last", ",", 
      RowBox[{"UpTo", "[", "990", "]"}]}], "]"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.740023043997447*^9, 3.740023165719596*^9}, {
  3.740023228038602*^9, 3.740023264108452*^9}, {3.7400235133118896`*^9, 
  3.7400235844882183`*^9}, {3.740023658455146*^9, 3.740023721039709*^9}, {
  3.7400239219008083`*^9, 3.740023947065342*^9}, {3.7400239921657963`*^9, 
  3.740023995747929*^9}, {3.7400240724688683`*^9, 3.7400241013094873`*^9}, {
  3.7400242630686007`*^9, 3.740024263385989*^9}, {3.740071842546307*^9, 
  3.74007187785083*^9}, {3.740071997125404*^9, 3.740072044037876*^9}, {
  3.740072163051943*^9, 3.7400721731428347`*^9}, {3.74007224284302*^9, 
  3.740072297024252*^9}, {3.7400799152146177`*^9, 3.740079979031191*^9}, {
  3.740080015671236*^9, 3.740080168395146*^9}, {3.740080437133752*^9, 
  3.740080477166597*^9}, {3.7400805207997313`*^9, 3.740080524514196*^9}, {
  3.740103482129985*^9, 
  3.740103482724518*^9}},ExpressionUUID->"499f6dc4-57a4-4a63-ade6-\
cbb3c584d13e"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "tnet", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"tnet", " ", "=", " ", 
   RowBox[{"Import", "[", "\"\<tnet.wlnet\>\"", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7399097966065493`*^9, 3.739909804664482*^9}, 
   3.7399215738223658`*^9, {3.7401033918697147`*^9, 3.740103408193245*^9}, 
   3.740103495336402*^9, 3.740103759223819*^9, {3.7401039146129436`*^9, 
   3.740103921340952*^9}, {3.740106947766136*^9, 3.740106951022047*^9}},
 CellLabel->
  "In[185]:=",ExpressionUUID->"88994d47-c954-4a85-882d-e607f3877d87"],

Cell[BoxData[
 TemplateBox[{
  "Import","nffil",
   "\"File not found during \\!\\(\\*RowBox[{\\\"Import\\\"}]\\).\"",2,186,14,
   21908034209120202327,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{{3.740106942069428*^9, 3.740106991705723*^9}},
 CellLabel->
  "During evaluation of \
In[185]:=",ExpressionUUID->"c3974941-bebb-4a9d-907d-b9595a21761b"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"tnetUninitilized", " ", "=", " ", 
  RowBox[{"NeuralNetworks`NetDeinitialize", "[", "tnet", "]"}]}]], "Input",
 CellChangeTimes->{{3.7400805796462383`*^9, 3.740080605639263*^9}},
 CellLabel->"In[23]:=",ExpressionUUID->"0826d825-e620-4c38-9acb-e3224c1dbcba"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "choppedTNet", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"choppedTNet", " ", "=", " ", 
   RowBox[{"NetTake", "[", 
    RowBox[{"tnetUninitilized", ",", "1"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7400803417023582`*^9, 3.740080345553279*^9}, 
   3.740080612939147*^9, 
   3.7401034970628757`*^9},ExpressionUUID->"80deeb42-47b0-4c23-b8bd-\
a2171155102b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "finalLayers", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<training starts...\>\"", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"finalLayers", " ", "=", " ", 
   RowBox[{"NetChain", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ConvolutionLayer", "[", 
        RowBox[{"64", ",", "2", ",", 
         RowBox[{"\"\<Stride\>\"", "\[Rule]", "2"}], ",", 
         RowBox[{"\"\<Input\>\"", "\[Rule]", 
          RowBox[{"{", 
           RowBox[{"512", ",", "8", ",", "8"}], "}"}]}]}], "]"}], ",", "Ramp",
        ",", 
       RowBox[{"FlattenLayer", "[", "]"}], ",", 
       RowBox[{"LinearLayer", "[", "512", "]"}], ",", "Ramp", ",", 
       RowBox[{"LinearLayer", "[", "1", "]"}], ",", "Abs"}], "}"}], ",", 
     RowBox[{"\"\<Input\>\"", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"512", ",", "8", ",", "8"}], "}"}]}], ",", 
     RowBox[{"\"\<Output\>\"", "\[Rule]", "\"\<Scalar\>\""}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{
  3.739876339075725*^9, 3.739876923248083*^9, {3.7398919052636843`*^9, 
   3.739891908775099*^9}, {3.740078568791813*^9, 3.740078584871428*^9}, {
   3.740080348927595*^9, 3.740080351410288*^9}, {3.740080815750037*^9, 
   3.7400808162004347`*^9}, {3.7400810984147253`*^9, 3.740081140050253*^9}, 
   3.740103499416512*^9, {3.7401035308427963`*^9, 
   3.740103541581168*^9}},ExpressionUUID->"309eefe3-bd30-4caa-ba7d-\
1ffea12ef0af"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "netJoined", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"netJoined", " ", "=", " ", 
   RowBox[{"NetJoin", "[", 
    RowBox[{"choppedTNet", ",", "finalLayers"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7398762842611027`*^9, 3.7398763348928223`*^9}, 
   3.739891914689711*^9, {3.7399098224818697`*^9, 3.739909855881054*^9}, {
   3.7399641971472607`*^9, 3.739964198387435*^9}, {3.740080353502095*^9, 
   3.7400803555846863`*^9}, {3.7400804179751368`*^9, 3.740080419544833*^9}, 
   3.740103501627923*^9},ExpressionUUID->"e8b59899-e41f-4ce4-855e-\
a05a53fc5789"],

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "netTrained", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"netTrained", " ", "=", " ", 
   RowBox[{"NetTrain", "[", 
    RowBox[{"netJoined", ",", "trainSmall", ",", 
     RowBox[{"ValidationSet", "\[Rule]", "validationSmall"}]}], "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.740080390315308*^9, 3.7400804206358747`*^9}, {
   3.74008049083025*^9, 3.740080498028865*^9}, 
   3.740103503863007*^9},ExpressionUUID->"0bd076c6-efa6-42d3-a84b-\
896a70202759"],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{"\"\<amazonTrainedNet.wlnet\>\"", ",", "netTrained"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.740081650193963*^9, 3.740081672790635*^9}, {
   3.740081708049321*^9, 3.7400817354375963`*^9}, {3.740081769105953*^9, 
   3.740081772093128*^9}, {3.740103425392725*^9, 3.740103425760022*^9}, 
   3.740103762236225*^9, {3.740103932933488*^9, 
   3.7401039369831753`*^9}},ExpressionUUID->"68c544fc-877c-4d32-8c6d-\
e9c9a75d4da2"]
},
WindowSize->{880, 855},
WindowMargins->{{Automatic, 0}, {Automatic, 0}},
FrontEndVersion->"11.3 for Mac OS X x86 (32-bit, 64-bit Kernel) (March 7, \
2018)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[561, 20, 211, 4, 30, "Input",ExpressionUUID->"5d132b6a-5bb9-44c4-b6c4-b487a14f0d7d"],
Cell[775, 26, 1685, 29, 72, "Code",ExpressionUUID->"9fb56a29-a30f-47ed-b0be-1e5588ff999d"],
Cell[2463, 57, 1948, 40, 167, "Code",ExpressionUUID->"481ed2c4-9e6c-491a-88f0-01bd59d05586"],
Cell[4414, 99, 1125, 21, 148, "Code",ExpressionUUID->"0e200563-c4d3-40f0-bb21-e86b49df1682"],
Cell[CellGroupData[{
Cell[5564, 124, 309, 7, 52, "Input",ExpressionUUID->"cf962838-5d57-4100-b48f-e1a5d0d45842"],
Cell[5876, 133, 155, 3, 34, "Output",ExpressionUUID->"57f399fd-f021-4607-b9cb-474bdfb7a679"]
}, Open  ]],
Cell[6046, 139, 1036, 22, 115, "Input",ExpressionUUID->"a876e179-bd04-46e2-b385-46ba621547ee"],
Cell[7085, 163, 1853, 38, 115, "Input",ExpressionUUID->"499f6dc4-57a4-4a63-ade6-cbb3c584d13e"],
Cell[CellGroupData[{
Cell[8963, 205, 571, 10, 52, "Input",ExpressionUUID->"88994d47-c954-4a85-882d-e607f3877d87"],
Cell[9537, 217, 374, 9, 24, "Message",ExpressionUUID->"c3974941-bebb-4a9d-907d-b9595a21761b"]
}, Open  ]],
Cell[9926, 229, 281, 4, 30, "Input",ExpressionUUID->"0826d825-e620-4c38-9acb-e3224c1dbcba"],
Cell[10210, 235, 415, 9, 52, "Input",ExpressionUUID->"80deeb42-47b0-4c23-b8bd-a2171155102b"],
Cell[10628, 246, 1532, 35, 157, "Input",ExpressionUUID->"309eefe3-bd30-4caa-ba7d-1ffea12ef0af"],
Cell[12163, 283, 616, 11, 52, "Input",ExpressionUUID->"e8b59899-e41f-4ce4-855e-a05a53fc5789"],
Cell[12782, 296, 508, 11, 52, "Input",ExpressionUUID->"0bd076c6-efa6-42d3-a84b-896a70202759"],
Cell[13293, 309, 472, 9, 30, "Input",ExpressionUUID->"68c544fc-877c-4d32-8c6d-e9c9a75d4da2"]
}
]
*)

